"use strict";function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};!function(i){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"function"==typeof require?module.exports=i(require("lodash")):"function"==typeof define&&define.amd&&define(["lodash"],i)}(function(i){var t=new WeakMap;return new function n(){_classCallCheck(this,n),this._instanceId=i.uniqueId("instanceId_"),t.set(this,{_indexBy:function(n,e){var o={};return t.get(this)._isCollection(n)&&i.each(n,function(t,n){var s;i.isFunction(e)?s=e(t,n):i.isString(e)&&(s=i.get(t,e)),i.isString(s)||(s=i.toString(n)),i.isPlainObject(i.get(o,s))&&(s=s+"("+n+")"),i.set(o,s,i.cloneDeep(t))}),o},_uniqify:function(n,e,o){i.isString(e)&&!i.isEmpty(e)||(e="uuid");var s=i.cloneDeep(n);return t.get(this)._isCollection(s)&&i.each(s,function(t,n){var r=i.uniqueId(e+"_");if(i.isFunction(o)){var c=o(t,n);i.isString(c)&&(r=c)}i.isPlainObject(i.find(s,i.set({},e,r)))&&(r=r+"("+n+")"),i.set(t,e,r)}),s},_isCollection:function(t){return!!i.isArray(t)&&i.every(t,function(t){return i.isPlainObject(t)})},_pickAsCore:function(t,n,e,o){return i.set(e,o,i.get(t,n)),e},_pickAsSingleObject:function(t,n,e){if(i.isArray(n)&&!e)return i.pick(t,n);var o={};if(i.isPlainObject(n)||(n={}),i.isEmpty(n)){if(e)return i.pick(t,i.keys(t))}else e&&(o=i.omit(t,i.keys(n))),i.each(n,function(i,n){this._pickAsCore(t,n,o,i)}.bind(this));return o},_executePickAs:function(t,n,e){return i.isPlainObject(t)?this._pickAsSingleObject(t,n,e):this._isCollection(t)?i.map(t,function(i){return this._pickAsSingleObject(i,n,e)}.bind(this)):t},_pickAs:function(i,n){return t.get(this)._executePickAs(i,n,!1)},_pickAllAs:function(i,n){return t.get(this)._executePickAs(i,n,!0)},_executeJoinOn:function(t,n,e,o,s){var r=i.map(n,function(n){var r=i.find(e,function(t){return i.get(n,o)===i.get(t,s)});return t?i.isPlainObject(r)?i.defaults(i.cloneDeep(n),r):void 0:i.defaults(i.cloneDeep(n),r)});return i.reject(r,function(t){return i.isUndefined(t)})},_getLeftAntiJoinCollection:function(t,n,e,o){return i.reject(t,function(t){var s=i.find(n,i.set({},o,i.get(t,e)));return i.isPlainObject(s)})},_executeAntiJoinOn:function(i,t,n,e,o){var s=this._getLeftAntiJoinCollection(t,n,e,o);if(i){var r=this._getLeftAntiJoinCollection(n,t,o,e);return s.concat(r)}return s},_executeFullJoin:function(i,t,n,e,o){var s=this._executeJoinOn(i,t,n,e,o),r=this._getLeftAntiJoinCollection(n,t,o,e);return s.concat(r)},_validateBeforeExecuteJoin:function(i,t,n,e,o,s){return s=s||o,this._isCollection(n)&&this._isCollection(e)?this[i](t,n,e,o,s):[]},_beforeValidate:function(i,t){return this._validateBeforeExecuteJoin.apply(this,i.concat(Array.prototype.slice.call(t)))},_joinOn:function(){return t.get(this)._beforeValidate(["_executeJoinOn",!1],arguments)},_rightJoin:function(i,n,e,o){var s=[n,i,o||e,e];return t.get(this)._beforeValidate(["_executeJoinOn",!1],s)},_innerJoin:function(){return t.get(this)._beforeValidate(["_executeJoinOn",!0],arguments)},_fullJoin:function(){return t.get(this)._beforeValidate(["_executeFullJoin",!1],arguments)},_leftAntiJoin:function(){return t.get(this)._beforeValidate(["_executeAntiJoinOn",!1],arguments)},_rightAntiJoin:function(i,n,e,o){var s=[n,i,o||e,e];return t.get(this)._beforeValidate(["_executeAntiJoinOn",!1],s)},_fullAntiJoin:function(){return t.get(this)._beforeValidate(["_executeAntiJoinOn",!0],arguments)}}),this.indexBy=function(){return t.get(this)._indexBy.apply(this,arguments)},this.uniqify=function(){return t.get(this)._uniqify.apply(this,arguments)},this.isCollection=function(){return t.get(this)._isCollection.apply(this,arguments)},this.pickAs=function(){return t.get(this)._pickAs.apply(this,arguments)},this.pickAllAs=function(){return t.get(this)._pickAllAs.apply(this,arguments)},this.select=function(){return t.get(this)._pickAs.apply(this,arguments)},this.selectAll=function(){return t.get(this)._pickAllAs.apply(this,arguments)},this.joinOn=function(){return t.get(this)._joinOn.apply(this,arguments)},this.leftJoin=function(){return t.get(this)._joinOn.apply(this,arguments)},this.rightJoin=function(){return t.get(this)._rightJoin.apply(this,arguments)},this.innerJoin=function(){return t.get(this)._innerJoin.apply(this,arguments)},this.fullJoin=function(){return t.get(this)._fullJoin.apply(this,arguments)},this.leftAntiJoin=function(){return t.get(this)._leftAntiJoin.apply(this,arguments)},this.rightAntiJoin=function(){return t.get(this)._rightAntiJoin.apply(this,arguments)},this.fullAntiJoin=function(){return t.get(this)._fullAntiJoin.apply(this,arguments)},this.getCollectionHelpers=function(){var i=t.get(this);return{isCollection:i._isCollection.bind(this),pickAs:i._pickAs.bind(this),pickAllAs:i._pickAllAs.bind(this),select:i._pickAs.bind(this),selectAll:i._pickAllAs.bind(this),joinOn:i._joinOn.bind(this),leftJoin:i._joinOn.bind(this),rightJoin:i._rightJoin.bind(this),innerJoin:i._innerJoin.bind(this),fullJoin:i._fullJoin.bind(this),leftAntiJoin:i._leftAntiJoin.bind(this),rightAntiJoin:i._rightAntiJoin.bind(this),fullAntiJoin:i._fullAntiJoin.bind(this),indexBy:i._indexBy.bind(this),uniqify:i._uniqify.bind(this)}}}});