"use strict";function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};!function(i){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"function"==typeof require?module.exports=i(require("lodash"),require("uuid")):"function"==typeof define&&define.amd&&define(["lodash","uuid"],i)}(function(i,t){var n=new WeakMap;return new function e(){_classCallCheck(this,e),this._instanceId=t.v4(),n.set(this,{_indexBy:function(t,e){var o={};return n.get(this)._isCollection(t)&&i.each(t,function(t,n){var r;i.isFunction(e)?r=e(t,n):i.isString(e)&&(r=i.get(t,e)),i.isString(r)||(r=i.toString(n)),i.isPlainObject(i.get(o,r))&&(r=r+"("+n+")"),i.set(o,r,i.cloneDeep(t))}),o},_uniqify:function(e,o,r){i.isString(o)&&!i.isEmpty(o)||(o="uuid");var s=i.cloneDeep(e);return n.get(this)._isCollection(s)&&i.each(s,function(n,e){var c=t();if(i.isFunction(r)){var u=r(n,e);i.isString(u)&&(c=u)}i.isPlainObject(i.find(s,i.set({},o,c)))&&(c=c+"("+e+")"),i.set(n,o,c)}),s},_isCollection:function(t){return!!i.isArray(t)&&i.every(t,function(t){return i.isPlainObject(t)})},_pickAsCore:function(t,n,e,o){return i.set(e,o,i.get(t,n)),e},_pickAsSingleObject:function(t,n,e){if(i.isArray(n)&&!e)return i.pick(t,n);var o={};if(i.isPlainObject(n)||(n={}),i.isEmpty(n)){if(e)return i.pick(t,i.keys(t))}else e&&(o=i.omit(t,i.keys(n))),i.each(n,function(i,n){this._pickAsCore(t,n,o,i)}.bind(this));return o},_executePickAs:function(t,n,e){return i.isPlainObject(t)?this._pickAsSingleObject(t,n,e):this._isCollection(t)?i.map(t,function(i){return this._pickAsSingleObject(i,n,e)}.bind(this)):t},_pickAs:function(i,t){return n.get(this)._executePickAs(i,t,!1)},_pickAllAs:function(i,t){return n.get(this)._executePickAs(i,t,!0)},_executeJoinOn:function(t,n,e,o,r){var s=i.map(n,function(n){var s=i.find(e,function(t){return i.get(n,o)===i.get(t,r)});return t?i.isPlainObject(s)?i.defaults(i.cloneDeep(n),s):void 0:i.defaults(i.cloneDeep(n),s)});return i.reject(s,function(t){return i.isUndefined(t)})},_getLeftAntiJoinCollection:function(t,n,e,o){return i.reject(t,function(t){var r=i.find(n,i.set({},o,i.get(t,e)));return i.isPlainObject(r)})},_executeAntiJoinOn:function(i,t,n,e,o){var r=this._getLeftAntiJoinCollection(t,n,e,o);if(i){var s=this._getLeftAntiJoinCollection(n,t,o,e);return r.concat(s)}return r},_executeFullJoin:function(i,t,n,e,o){var r=this._executeJoinOn(i,t,n,e,o),s=this._getLeftAntiJoinCollection(n,t,o,e);return r.concat(s)},_validateBeforeExecuteJoin:function(i,t,n,e,o,r){return r=r||o,this._isCollection(n)&&this._isCollection(e)?this[i](t,n,e,o,r):[]},_beforeValidate:function(i,t){return this._validateBeforeExecuteJoin.apply(this,i.concat(Array.prototype.slice.call(t)))},_joinOn:function(){return n.get(this)._beforeValidate(["_executeJoinOn",!1],arguments)},_rightJoin:function(i,t,e,o){var r=[t,i,o||e,e];return n.get(this)._beforeValidate(["_executeJoinOn",!1],r)},_innerJoin:function(){return n.get(this)._beforeValidate(["_executeJoinOn",!0],arguments)},_fullJoin:function(){return n.get(this)._beforeValidate(["_executeFullJoin",!1],arguments)},_leftAntiJoin:function(){return n.get(this)._beforeValidate(["_executeAntiJoinOn",!1],arguments)},_rightAntiJoin:function(i,t,e,o){var r=[t,i,o||e,e];return n.get(this)._beforeValidate(["_executeAntiJoinOn",!1],r)},_fullAntiJoin:function(){return n.get(this)._beforeValidate(["_executeAntiJoinOn",!0],arguments)}}),this.indexBy=function(){return n.get(this)._indexBy.apply(this,arguments)},this.uniqify=function(){return n.get(this)._uniqify.apply(this,arguments)},this.isCollection=function(){return n.get(this)._isCollection.apply(this,arguments)},this.pickAs=function(){return n.get(this)._pickAs.apply(this,arguments)},this.pickAllAs=function(){return n.get(this)._pickAllAs.apply(this,arguments)},this.select=function(){return n.get(this)._pickAs.apply(this,arguments)},this.selectAll=function(){return n.get(this)._pickAllAs.apply(this,arguments)},this.joinOn=function(){return n.get(this)._joinOn.apply(this,arguments)},this.leftJoin=function(){return n.get(this)._joinOn.apply(this,arguments)},this.rightJoin=function(){return n.get(this)._rightJoin.apply(this,arguments)},this.innerJoin=function(){return n.get(this)._innerJoin.apply(this,arguments)},this.fullJoin=function(){return n.get(this)._fullJoin.apply(this,arguments)},this.leftAntiJoin=function(){return n.get(this)._leftAntiJoin.apply(this,arguments)},this.rightAntiJoin=function(){return n.get(this)._rightAntiJoin.apply(this,arguments)},this.fullAntiJoin=function(){return n.get(this)._fullAntiJoin.apply(this,arguments)},this.getCollectionHelpers=function(){var i=n.get(this);return{isCollection:i._isCollection.bind(this),pickAs:i._pickAs.bind(this),pickAllAs:i._pickAllAs.bind(this),select:i._pickAs.bind(this),selectAll:i._pickAllAs.bind(this),joinOn:i._joinOn.bind(this),leftJoin:i._joinOn.bind(this),rightJoin:i._rightJoin.bind(this),innerJoin:i._innerJoin.bind(this),fullJoin:i._fullJoin.bind(this),leftAntiJoin:i._leftAntiJoin.bind(this),rightAntiJoin:i._rightAntiJoin.bind(this),fullAntiJoin:i._fullAntiJoin.bind(this),indexBy:i._indexBy.bind(this),uniqify:i._uniqify.bind(this)}}}});