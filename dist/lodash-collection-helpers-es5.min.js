"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"function"==typeof require?module.exports=t(require("lodash"),require("uuid")):"function"==typeof define&&define.amd&&define(["lodash","uuid"],t)}(function(t,i){var n=new WeakMap;return new function e(){_classCallCheck(this,e),this._instanceId=i.v4(),n.set(this,{_isCollection:function(i){if(!t.isArray(i))return!1;var n=!0;return t.each(i,function(i){n=n&&t.isPlainObject(i)}),n},_pickAsCore:function(i,n,e,o){return t.set(e,o,t.get(i,n)),e},_pickAsSingleObject:function(i,n,e){if(t.isArray(n)&&!e)return t.pick(i,n);var o={};if(t.isPlainObject(n)||(n={}),t.isEmpty(n)){if(e)return t.pick(i,t.keys(i))}else e&&(o=t.omit(i,t.keys(n))),t.each(n,function(t,n){this._pickAsCore(i,n,o,t)}.bind(this));return o},_executePickAs:function(i,n,e){return t.isPlainObject(i)?this._pickAsSingleObject(i,n,e):this._isCollection(i)?t.map(i,function(t){return this._pickAsSingleObject(t,n,e)}.bind(this)):i},_pickAs:function(t,i){return n.get(this)._executePickAs(t,i,!1)},_pickAllAs:function(t,i){return n.get(this)._executePickAs(t,i,!0)},_executeJoinOn:function(i,n,e,o,r){var s=t.map(n,function(n){var s=t.find(e,t.set({},r,t.get(n,o)));return i?t.isPlainObject(s)?t.defaults(t.cloneDeep(n),s):void 0:t.defaults(t.cloneDeep(n),s)});return t.reject(s,function(i){return t.isUndefined(i)})},_getLeftAntiJoinCollection:function(i,n,e,o){return t.reject(i,function(i){var r=t.find(n,t.set({},o,t.get(i,e)));return t.isPlainObject(r)})},_executeAntiJoinOn:function(t,i,n,e,o){var r=this._getLeftAntiJoinCollection(i,n,e,o);if(t){var s=this._getLeftAntiJoinCollection(n,i,o,e);return r.concat(s)}return r},_executeFullJoin:function(t,i,n,e,o){var r=this._executeJoinOn(t,i,n,e,o),s=this._getLeftAntiJoinCollection(n,i,o,e);return r.concat(s)},_validateBeforeExecuteJoin:function(t,i,n,e,o,r){return r=r||o,this._isCollection(n)&&this._isCollection(e)?this[t](i,n,e,o,r):[]},_beforeValidate:function(t,i){return this._validateBeforeExecuteJoin.apply(this,t.concat(Array.prototype.slice.call(i)))},_joinOn:function(){return n.get(this)._beforeValidate(["_executeJoinOn",!1],arguments)},_rightJoin:function(t,i,e,o){var r=[i,t,o||e,e];return n.get(this)._beforeValidate(["_executeJoinOn",!1],r)},_innerJoin:function(){return n.get(this)._beforeValidate(["_executeJoinOn",!0],arguments)},_fullJoin:function(){return n.get(this)._beforeValidate(["_executeFullJoin",!1],arguments)},_leftAntiJoin:function(){return n.get(this)._beforeValidate(["_executeAntiJoinOn",!1],arguments)},_rightAntiJoin:function(t,i,e,o){var r=[i,t,o||e,e];return n.get(this)._beforeValidate(["_executeAntiJoinOn",!1],r)},_fullAntiJoin:function(){return n.get(this)._beforeValidate(["_executeAntiJoinOn",!0],arguments)}}),this.isCollection=function(){return n.get(this)._isCollection.apply(this,arguments)},this.pickAs=function(){return n.get(this)._pickAs.apply(this,arguments)},this.pickAllAs=function(){return n.get(this)._pickAllAs.apply(this,arguments)},this.select=function(){return n.get(this)._pickAs.apply(this,arguments)},this.selectAll=function(){return n.get(this)._pickAllAs.apply(this,arguments)},this.joinOn=function(){return n.get(this)._joinOn.apply(this,arguments)},this.leftJoin=function(){return n.get(this)._joinOn.apply(this,arguments)},this.rightJoin=function(){return n.get(this)._rightJoin.apply(this,arguments)},this.innerJoin=function(){return n.get(this)._innerJoin.apply(this,arguments)},this.fullJoin=function(){return n.get(this)._fullJoin.apply(this,arguments)},this.leftAntiJoin=function(){return n.get(this)._leftAntiJoin.apply(this,arguments)},this.rightAntiJoin=function(){return n.get(this)._rightAntiJoin.apply(this,arguments)},this.fullAntiJoin=function(){return n.get(this)._fullAntiJoin.apply(this,arguments)},this.getCollectionHelpers=function(){var t=n.get(this);return{isCollection:t._isCollection.bind(this),pickAs:t._pickAs.bind(this),pickAllAs:t._pickAllAs.bind(this),select:t._pickAs.bind(this),selectAll:t._pickAllAs.bind(this),joinOn:t._joinOn.bind(this),leftJoin:t._joinOn.bind(this),rightJoin:t._rightJoin.bind(this),innerJoin:t._innerJoin.bind(this),fullJoin:t._fullJoin.bind(this),leftAntiJoin:t._leftAntiJoin.bind(this),rightAntiJoin:t._rightAntiJoin.bind(this),fullAntiJoin:t._fullAntiJoin.bind(this)}}}});